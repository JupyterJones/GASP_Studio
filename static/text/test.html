<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Walking Puppet Loop with Background</title>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
<style>
body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
canvas {
    background: #222;
}
</style>
<!-- 
1. The Required Sizes (Typical for a 512–768px Puppet)
When people make walking puppets for canvas animation, they generally use pieces like this:
Part  Typical Size (px) Notes
Head  100×100 Centered, neck near bottom
Torso 120×200 Anchor at hip center
Upper Arm 40×120  Shoulder at top
Lower Arm 40×120  Joint at top
Upper Leg 50×150  Hip at top
Lower Leg 50×150  Knee at top
Foot  60×40 Ankle near top
 -->
</head>
<body>
<canvas id="canvas" width="1000" height="600"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

// --- Global scale factor ---
const scale = 0.6; // adjust overall puppet size

// --- Background image ---
const bg = new Image();
bg.src = "background_scene.jpg"; // <-- your background image
let bgLoaded = false;
bg.onload = () => bgLoaded = true;

// --- Load images ---
const parts = {};
const partFiles = {
  torso: 'Bottorso2.png',
  head: 'Bothead5.png',
  upperArmL: 'Botupper_arm_L.png',
  lowerArmL: 'Botlower_arm_L.png',
  upperArmR: 'Botupper_arm_R.png',
  lowerArmR: 'Botlower_arm_R.png',
  upperLegL: 'Botupper_legL.png',
  lowerLegL: 'Botlower_legL.png',
  upperLegR: 'Botupper_legR.png',
  lowerLegR: 'Botlower_legR.png',
  footL: 'Botfoot_l.png',
  footR: 'Botfoot_r.png'
};

let loaded = 0;
const totalParts = Object.keys(partFiles).length;

for (let key in partFiles) {
  parts[key] = new Image();
  parts[key].src = partFiles[key];
  parts[key].onload = () => {
    loaded++;
    if (loaded === totalParts) init();
  };
}

// --- Puppet definition (for ~100x100 head, 120x200 torso, 40x150 limbs) ---
const puppet = {
  x: 200, y: 340,
  torso: { angle: 0, offsetX: 0, offsetY: 0 },
  head: { angle: 0, offsetX: 0, offsetY: -160 },
  upperArmL: { angle: 0, offsetX: -60, offsetY: -120 },
  lowerArmL: { angle: 0, offsetX: 0, offsetY: 100 },
  upperArmR: { angle: 0, offsetX: 60, offsetY: -120 },
  lowerArmR: { angle: 0, offsetX: 0, offsetY: 100 },
  upperLegL: { angle: 0, offsetX: -35, offsetY:30 },
  lowerLegL: { angle: 0, offsetX: 0, offsetY: 120 },
  footL: { angle: 0, offsetX: 0, offsetY: 100 },
  //                                   height 
  upperLegR: { angle: 0, offsetX: 20, offsetY: 55 },
  lowerLegR: { angle: 0, offsetX: 0, offsetY: 120 },
  footR: { angle: 0, offsetX: 0, offsetY: 100 }
};

// --- Initialize walking animation ---
function init() {
  const speed = 1.2;

  // Legs swing opposite each other
  gsap.to(puppet.upperLegL, {angle: Math.PI/6, duration:speed, yoyo:true, repeat:-1, ease:'sine.inOut'});
  gsap.to(puppet.lowerLegL, {angle: -Math.PI/8, duration:speed, yoyo:true, repeat:-1, ease:'sine.inOut'});
  gsap.to(puppet.footL,      {angle:  Math.PI/12, duration:speed, yoyo:true, repeat:-1, ease:'sine.inOut'});

  gsap.to(puppet.upperLegR, {angle: -Math.PI/6, duration:speed, yoyo:true, repeat:-1, ease:'sine.inOut'});
  gsap.to(puppet.lowerLegR, {angle:  Math.PI/8, duration:speed, yoyo:true, repeat:-1, ease:'sine.inOut'});
  gsap.to(puppet.footR,      {angle: -Math.PI/12, duration:speed, yoyo:true, repeat:-1, ease:'sine.inOut'});

  // Arms swing opposite to legs
  gsap.to(puppet.upperArmL, {angle: -Math.PI/6, duration:speed, yoyo:true, repeat:-1, ease:'sine.inOut'});
  gsap.to(puppet.lowerArmL, {angle: -Math.PI/12, duration:speed, yoyo:true, repeat:-1, ease:'sine.inOut'});

  gsap.to(puppet.upperArmR, {angle: Math.PI/6, duration:speed, yoyo:true, repeat:-1, ease:'sine.inOut'});
  gsap.to(puppet.lowerArmR, {angle: Math.PI/12, duration:speed, yoyo:true, repeat:-1, ease:'sine.inOut'});

  // Puppet forward movement loop
  gsap.to(puppet, {
    x: canvas.width + 150, 
    duration: 60, 
    repeat: -1, 
    ease: 'linear', 
    onRepeat: () => { puppet.x = -150; }
  });

  draw();
}
//use the defaults
gsap.to(element, {duration: 1, scrambleText: "THIS IS NEW TEXT"});//or customize things:

gsap.to(element, {
  duration: 1, 
  scrambleText: {
    text: "THIS IS NEW TEXT", 
    chars: "XO", 
    revealDelay: 0.5, 
    speed: 0.3, 
    newClass: "myClass"
  }
});
// --- Draw function ---
function draw() {
  // Draw background first
  if (bgLoaded) {
    ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);
  } else {
    ctx.fillStyle = "#222";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  // Draw left side limbs first for depth
  drawLimb(puppet.upperLegL, puppet.lowerLegL, parts.upperLegL, parts.lowerLegL, parts.footL);
  drawLimb(puppet.upperArmL, puppet.lowerArmL, parts.upperArmL, parts.lowerArmL);

  // Torso and head
  drawPart(parts.torso, puppet.x + puppet.torso.offsetX * scale, puppet.y + puppet.torso.offsetY * scale, puppet.torso.angle);
  drawPart(parts.head,   puppet.x + puppet.head.offsetX * scale,   puppet.y + puppet.head.offsetY * scale,   puppet.head.angle);


  drawLimb(puppet.upperLegR, puppet.lowerLegR, parts.upperLegR, parts.lowerLegR, parts.footR);

  // Right side limbs
  drawLimb(puppet.upperArmR, puppet.lowerArmR, parts.upperArmR, parts.lowerArmR);


  requestAnimationFrame(draw);
}

// --- Helper functions ---
function drawLimb(upper, lower, upperImg, lowerImg, footImg) {
  const startX = puppet.x + upper.offsetX * scale;
  const startY = puppet.y + upper.offsetY * scale;

  ctx.save();
  ctx.translate(startX, startY);
  ctx.rotate(upper.angle);
  ctx.drawImage(upperImg, -upperImg.width/2 * scale, 0, upperImg.width * scale, upperImg.height * scale);

  // Slightly shorten joint connection to bring limbs closer
  ctx.translate(0, upperImg.height * scale * 0.9);
  ctx.rotate(lower.angle);
  ctx.drawImage(lowerImg, -lowerImg.width/2 * scale, 0, lowerImg.width * scale, lowerImg.height * scale);

  if (footImg) {
    ctx.translate(0, lowerImg.height * scale * 0.9);
    ctx.rotate(footImg.angle || 0);
    ctx.drawImage(footImg, -footImg.width/2 * scale, 0, footImg.width * scale, footImg.height * scale);
  }

  ctx.restore();
}

function drawPart(img, x, y, angle=0) {
  ctx.save();
  ctx.translate(x, y);
  ctx.rotate(angle);
  ctx.drawImage(img, -img.width/2 * scale, -img.height/2 * scale, img.width * scale, img.height * scale);
  ctx.restore();
}
</script>
</body>
</html>
